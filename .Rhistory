gokCombine
## area-to-area co-kriging of AOD-3k and AOD-10 ----
# fit variogram
vars <- list(aod3k=d1, aod10=d2)
gck <- deconvPointVgmForCoKriging(vars, model="Exp", ngroup=12, rd=0.75, fixed.range = 8e4,
maxSampleNum=100, return.simple=F, fig=T)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- ataKrig:::.rbindDiscreteAreas(aod3k.d, aod10.d)
setwd("E:/AtoACokriging/Demo_BJ")
## demo data ----
aod3k <- raster("MOD04_3K.A2017042_BJ.tif") * 1000
aod10 <- raster("MOD04_L2.A2017042_BJ.tif") * 1000
aod3k.d <- discretizeRaster(aod3k, 1000)
aod10.d <- discretizeRaster(aod10, 1000)
d1$areaValues$value <- log(d1$areaValues$value)
hist(aod3k.d$areaValues$value)
hist(aod10.d$areaValues$value)
aod3k.d$areaValues$value <- log(aod3k.d$areaValues$value)
aod10.d$areaValues$value <- log(aod10.d$areaValues$value)
hist(aod3k.d$areaValues$value)
hist(aod10.d$areaValues$value)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- ataKrig:::.rbindDiscreteAreas(aod3k.d, aod10.d)
set.seed(100)
v.ok_combine <- deconvPointVgm(aod.combine, model=c("Sph","Exp","Gau"), ngroup=12, rd=0.75, maxSampleNum=100)
v.ok_combine
# point-scale cross-variogram
aod.list <- list(aod3k=aod3k.d, aod10=aod10.d)
v.ck <- deconvPointVgmForCoKriging(aod.list, model="Exp", ngroup=12, rd=0.75, fixed.range = 8e4, maxSampleNum=100)
v.ck
# ataEnableCluster()
grid.pred <- discretizeRaster(aod3k, 1000, type = "all")
ataEnableCluster()
ataEnableCluster()
class(grid.pred)
library(ataKrig)
pred.ok_combine <- ataKriging(aod.combine, grid.pred, gokCombine$pointVariogram, nmax = 15)
ataEnableCluster()
pred.ok_combine <- ataKriging(aod.combine, grid.pred, v.ok_combine, nmax = 15)
# ok
pred.ataok <- ataKriging(aod10.d, grid.pred, v.ck$aod10)
pred.ataok_combine
pred.ataok_combine <- ataKriging(aod.combine, grid.pred, v.ok_combine)
# co-kriging (aod10 as primary variable)
pred.atack <- ataCoKriging(aod.list, destVarId="aod10", unknown = grid.pred, ptVgms=v.ck)
pred.atask <- ataCoKriging(aod.list, destVarId="aod10", unknown = grid.pred, ptVgms=v.ck, simple = TRUE, auxRatioAdj = F)
pred.atask2 <- ataCoKriging(aod.list, destVarId="aod10", unknown = grid.pred, ptVgms=v.ck, simple = TRUE, auxRatioAdj = T)
# reverse log transform
pred.ataok$pred <- exp(pred.ataok$pred)
pred.ataok$var <- exp(pred.ataok$var)
pred.ataok_combine$pred <- exp(pred.ataok_combine$pred)
pred.ataok_combine$var <- exp(pred.ataok_combine$var)
pred.atack$pred <- exp(pred.atack$pred)
pred.atack$var <- exp(pred.atack$var)
pred.atask$pred <- exp(pred.atask$pred)
pred.atask$var <- exp(pred.atask$var)
pred.atask2$pred <- exp(pred.atask2$pred)
pred.atask2$var <- exp(pred.atask2$var)
names(pred.ataok)
names(pred.ataok_combine)
# convert result to raster
pred.ataok.r <- rasterFromXYZ(pred.ataok[,-1])
pred.ataok_combine.r <- rasterFromXYZ(pred.ataok_combine[,-1])
pred.atack.r <- rasterFromXYZ(pred.atack[,-1])
pred.atask.r <- rasterFromXYZ(pred.atask[,-1])
pred.atask2.r <- rasterFromXYZ(pred.atask2[,-1])
# display
pred <- stack(aod3k, pred.ataok_combine.r$pred, pred.ataok.r$pred, pred.atack.r$pred, pred.atask.r$pred, pred.atask2.r$pred)
names(pred) <- c("aod3k","ok_combine","ataok","atack","atask","atask2")
spplot(pred) # col.regions = heat.colors(100)
getwd()
# save to disk
writeRaster(pred.ataok.r, "./estimation/pred_ataok_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.ataok_combine.r, "./estimation/pred_ataok_combine.tif", overwrite=TRUE)
writeRaster(pred.atack.r, "./estimation/pred_atack_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.atask.r, "./estimation/pred_atask_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.atask2.r, "./estimation/pred_atask2_byLogAOD10.tif", overwrite=TRUE)
# save to disk
writeRaster(pred.ataok.r, "./estimation/pred_ataok_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.ataok_combine.r, "./estimation/pred_ataok_combine.tif", overwrite=TRUE)
writeRaster(pred.atack.r, "./estimation/pred_atack_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.atask.r, "./estimation/pred_atask_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.atask2.r, "./estimation/pred_atask2_byLogAOD10.tif", overwrite=TRUE)
Moran(pred.ataok_combine.r$pred)
Moran(pred.ataok.r$pred)
Moran(pred.atack.r$pred)
Moran(pred.atask.r$pred)
Moran(pred.atask2.r$pred)
tiff("./fig/vokCombine.tif", width = 550, height = 500, pointsize = 4.5, compression = "lzw", res = 300)
plotDeconvVgm(v.ok_combine, showRegVgm =F, lwd = 1)
dev.off()
tiff("./fig/vck.tif", width = 1100, height = 1000, pointsize = 7, compression = "lzw", res = 300)
plotDeconvVgm(v.ck, showRegVgm = F, lwd = 1)
dev.off()
save(list=ls(), file = "Demo_BJ_byLog3.rdata")
ataStopCluster()
library(ataKrig)
library(ataKrig)
library(ataKrig)
citation()
library(ataKrig)
remove.packages("ataKrig")
library(atakrig)
library(atakrig)
library(atakrig)
library(atakrig)
library(ataKrig)
library(rgdal)
wd = "E:/humg/AtoACokriging/Demo_water"
observations <- readOGR(".", "observations")
wd = "E:/humg/AtoACokriging/Demo_water"
setwd(wd)
wd = "E:/AtoACokriging/Demo_water"
setwd(wd)
observations <- readOGR(".", "observations")
observations$obs = observations$QSUMMER_OB/observations$AREASQKM
library(ataKrig)
library(rgdal)
rpath <- system.file("extdata", package="rtop")
observations <- readOGR(rpath, "observations")
predictionLocations <- readOGR(rpath, "predictionLocations")
observations$obs = observations$QSUMMER_OB/observations$AREASQKM
hist(observations$obs)
observations$logObs <- log(observations$obs)
# discretize polygons
d1 <- discretizePolygon(observations, cellsize = 1500, idfield = "ID", valuefield = "logObs")
# point-scale semivariogram deconvolution
gokDeconv <- deconvPointVgm(d1, model=c("Sph","Gau","Exp"), ngroup=12, rd=0.75, maxSampleNum = Inf, fig=T)
tiff("./../Demo_water/gok.tif", width = 2*550, height = 2*500, pointsize = 4.5, compression = "lzw", res = 300)
plotDeconvVgm(gokDeconv, showRegVgm =F, lwd = 1)
dev.off()
tiff("./../Demo_water/gok.tif", width = 2*550, height = 2*500, pointsize = 2*4.5, compression = "lzw", res = 300)
plotDeconvVgm(gokDeconv, showRegVgm =F, lwd = 1)
dev.off()
observations
length(observations)
library(ataKrig)
library(rgdal)
rpath <- system.file("extdata", package="rtop")
observations <- readOGR(rpath, "observations")
observations$obs
observations$QSUMMER_OB/observations$AREASQKM
library(ataKrig)
library(atakrig)
library(rgdal)
rpath <- system.file("extdata", package="rtop")
observations <- readOGR(rpath, "observations")
# discretize polygons
obs.discrete <- discretizePolygon(observations, cellsize = 1500, idfield = "ID", valuefield = "logObs")
observations$logObs <- log(observations$obs)
# discretize polygons
obs.discrete <- discretizePolygon(observations, cellsize = 1500, idfield = "ID", valuefield = "logObs")
pointsv
# point-scale semivariogram deconvolution
pointsv <- deconvPointVgm(obs.discrete, model=c("Sph","Gau","Exp"), ngroup=12, rd=0.75, maxSampleNum = Inf, fig=T)
# prediction
predictionLocations <- readOGR(rpath, "predictionLocations")
pred.discrete <- discretizePolygon(predictionLocations, cellsize = 1500, idfield = "ID")
pred$pred <- exp(pred$pred)
pred <- ataKriging(obs.discrete, pred.discrete$discretePoints, pointsv$pointVariogram, nmax = 10)
pred$pred <- exp(pred$pred)
pred$var <- exp(pred$var)
names(pred)
openxlsx::write.xlsx(pred, "e:/pred.xlsx")
pred <- ataKriging(obs.discrete, pred.discrete, pointsv$pointVariogram, nmax = 10)
library(rgdal)
library(rtop)
rpath = system.file("extdata",package="rtop")
observations = readOGR(rpath,"observations")
predictionLocations = readOGR(rpath,"predictionLocations")
observations$obs = observations$QSUMMER_OB/observations$AREASQKM
# Setting some parameters; nclus > 1 will start a cluster with nclus
# workers for parallel processing
params = list(gDist = TRUE, cloud = FALSE, nclus = 1, rresol = 25)
# Build an object
rtopObj = createRtopObject(observations, predictionLocations, obs~1, params = params)
# Fit a variogram (function also creates it)
rtopObj = rtopFitVariogram(rtopObj)
# Predicting at prediction locations
rtopObj = rtopKrige(rtopObj)
# Cross-validation
rtopObj = rtopKrige(rtopObj, cv=TRUE)
cor(rtopObj$predictions$observed, rtopObj$predictions$var1.pred)
predictions = rtopObj$predictions
# Build an object
rtopObj = createRtopObject(observations, predictionLocations, obs~1, params = params)
# Fit a variogram (function also creates it)
rtopObj = rtopFitVariogram(rtopObj)
# Predicting at prediction locations
rtopObj = rtopKrige(rtopObj)
# Cross-validation
rtopObj = rtopKrige(rtopObj, cv=TRUE)
cor(rtopObj$predictions$observed, rtopObj$predictions$var1.pred)
predictions = rtopObj$predictions
sstot = sum((predictions$obs - mean(predictions$obs))^2)
rtopsserr = sum((predictions$obs - predictions$var1.pred)^2)
rtoprsq = 1 - rtopsserr/sstot
# 0.5341022
summary(predictions)
predictions
names(predictions)
write.csv(predictions@data, "e:/pred_rtop.csv")
write.csv(predictions@data, "e:/pred_rtop.csv", row.names = F)
## predictions
rtopPred = rtopKrige(rtopObj)
dim(rtopPred$predictions@data)
write.csv(rtopPred$predictions@data, "e:/pred_rtop.csv", row.names = F)
cor(cv$obs, cv$pred)
library(atakrig)
library(atakrig)
library(rgdal)
rpath <- system.file("extdata", package="rtop")
observations <- readOGR(rpath, "observations")
hist(observations$obs)
observations$obs <- log(observations$obs)
# discretize polygons
obs.discrete <- discretizePolygon(observations, cellsize = 1500, id = "ID", value = "obs")
# point-scale semivariogram deconvolution
pointsv <- deconvPointVgm(obs.discrete, model=c("Sph","Gau","Exp"), ngroup=12, rd=0.75, maxSampleNum = Inf, fig=T)
# cross validation
cv <- ataKriging.cv(obs.discrete, nfold = nrow(obs.discrete$areaValues), pointsv)
cor(exp(cv$obs), exp(cv$pred))
cor(exp(cv$obs), exp(cv$value))
names(cv)
cor(exp(cv$value), exp(cv$pred))
0.8186176^2
cv$pred <- exp(cv$pred)
cv$obs <- exp(cv$value)
sstot = sum((cv$obs - mean(cv$obs))^2)
sserr = sum((cv$obs - cv$pred)^2)
rsq = 1 - sserr/sstot
rsq
# mae
mean(abs(cv$obs - cv$pred))
# rmse
sqrt(mean((cv$obs - cv$pred)^2))
cor(exp(pred.cv $value), exp(pred.cv $pred))
library(atakrig)
library(rgdal)
rpath <- system.file("extdata", package="rtop")
observations <- readOGR(rpath, "observations")
hist(observations$obs)
observations$obs <- log(observations$obs)
hist(observations$obs)
obs.discrete <- discretizePolygon(observations, cellsize=1500, id="ID", value=" obs")
obs.discrete <- discretizePolygon(observations, cellsize=1500, id="ID", value="obs")
pointsv <- deconvPointVgm(obs.discrete, model=c("Sph","Gau","Exp"), ngroup=12, rd=0.75, maxSampleNum = Inf, fig=T)
pred.cv <- ataKriging.cv(obs.discrete, nfold=nrow(obs.discrete$areaValues), pointsv$pointVariogram)
pred.cv <- ataKriging.cv(obs.discrete, nfold=nrow(obs.discrete$areaValues), pointsv)
cor(exp(pred.cv $value), exp(pred.cv $pred))
pred.cv$pred <- exp(pred.cv$pred)
pred.cv$obs <- exp(pred.cv$value)
sstot = sum((pred.cv$obs - mean(pred.cv$obs))^2)
sserr = sum((pred.cv$obs - pred.cv$pred)^2)
rsq = 1 - sserr/sstot
rsq
# mae
mean(abs(pred.cv$obs - pred.cv$pred))
# rmse
sqrt(mean((pred.cv$obs - pred.cv$pred)^2))
library(rgdal)
library(rtop)
rpath = system.file("extdata",package="rtop")
observations = readOGR(rpath,"observations")
predictionLocations = readOGR(rpath,"predictionLocations")
observations$obs = observations$QSUMMER_OB/observations$AREASQKM
# Setting some parameters; nclus > 1 will start a cluster with nclus
# workers for parallel processing
params = list(gDist = TRUE, cloud = FALSE, nclus = 1, rresol = 25)
# Build an object
rtopObj = createRtopObject(observations, predictionLocations, obs~1, params = params)
# Fit a variogram (function also creates it)
rtopObj = rtopFitVariogram(rtopObj)
# Predicting at prediction locations
rtopObj = rtopKrige(rtopObj)
# Cross-validation
rtopObj = rtopKrige(rtopObj, cv=TRUE)
cor(rtopObj$predictions$observed, rtopObj$predictions$var1.pred)
predictions = rtopObj$predictions
sstot = sum((predictions$obs - mean(predictions$obs))^2)
rtopsserr = sum((predictions$obs - predictions$var1.pred)^2)
rtoprsq = 1 - rtopsserr/sstot
rtoprsq
cor(rtopObj$predictions$observed,rtopObj$predictions$var1.pred)
# mae
mean(abs(rtopObj$predictions$observed - rtopObj$predictions$var1.pred))
# rmse
sqrt(mean((rtopObj$predictions$observed - rtopObj$predictions$var1.pred)^2))
(0.00275057-0.002386647)/0.002386647
library(atakrig)
library(rgdal)
rpath <- system.file("extdata", package="rtop")
observations <- readOGR(rpath, "observations")
hist(observations$obs)
observations$obs <- log(observations$obs)
obs.discrete <- discretizePolygon(observations, cellsize=1500, id="ID", value="obs")
pointsv <- deconvPointVgm(obs.discrete, model=c("Sph","Gau","Exp"), ngroup=12, rd=0.75, maxSampleNum = Inf, fig=T)
pred.cv <- ataKriging.cv(obs.discrete, nfold=nrow(obs.discrete$areaValues), pointsv)
print(cor(exp(pred.cv $value), exp(pred.cv $pred)))
plot(exp(pred.cv $value), exp(pred.cv $pred))
rpath <- system.file("extdata", package="atakrig")
library(atakrig)
rpath
aod3k <- raster(file.path(rpath, "MOD04_3K.A2017042_BJ.tif"))
require(raster)
aod3k <- raster(file.path(rpath, "MOD04_3K.A2017042_BJ.tif"))
aod3k <- raster(file.path(rpath, "MOD04_3K_A2017042.tif"))
aod3k
## demo data ----
aod3k <- raster(file.path(rpath, "MOD04_3K_A2017042.tif"))
aod10 <- raster(file.path(rpath, "MOD04_L2_A2017042.tif"))
aod10
aod3k.d <- discretizeRaster(aod3k, 1000)
aod10.d <- discretizeRaster(aod10, 1000)
hist(aod3k.d$areaValues$value)
hist(aod10.d$areaValues$value)
aod3k.d$areaValues$value <- log(aod3k.d$areaValues$value)
aod10.d$areaValues$value <- log(aod10.d$areaValues$value)
hist(aod3k.d$areaValues$value)
hist(aod10.d$areaValues$value)
# point-scale cross-variogram
aod.list <- list(aod3k=aod3k.d, aod10=aod10.d)
v.ck <- deconvPointVgmForCoKriging(aod.list, model="Exp", ngroup=12, rd=0.75, fixed.range = 8e4, maxSampleNum=100)
require(raster)
library(ataKrig)
library(raster)
## demo data ----
rpath <- system.file("extdata", package="atakrig")
library(atakrig)
library(raster)
## demo data ----
rpath <- system.file("extdata", package="atakrig")
aod3k <- raster(file.path(rpath, "MOD04_3K_A2017042.tif"))
aod10 <- raster(file.path(rpath, "MOD04_L2_A2017042.tif"))
aod3k.d <- discretizeRaster(aod3k, 1000)
aod10.d <- discretizeRaster(aod10, 1000)
# hist(aod3k.d$areaValues$value)
# hist(aod10.d$areaValues$value)
aod3k.d$areaValues$value <- log(aod3k.d$areaValues$value)
aod10.d$areaValues$value <- log(aod10.d$areaValues$value)
set.seed(100)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- ataKrig:::rbindDiscreteArea(aod3k.d, aod10.d)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
library(atakrig)
library(raster)
## demo data ----
rpath <- system.file("extdata", package="atakrig")
aod3k <- raster(file.path(rpath, "MOD04_3K_A2017042.tif"))
aod10 <- raster(file.path(rpath, "MOD04_L2_A2017042.tif"))
aod3k.d <- discretizeRaster(aod3k, 1000)
aod10.d <- discretizeRaster(aod10, 1000)
# hist(aod3k.d$areaValues$value)
# hist(aod10.d$areaValues$value)
aod3k.d$areaValues$value <- log(aod3k.d$areaValues$value)
aod10.d$areaValues$value <- log(aod10.d$areaValues$value)
set.seed(100)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
library(atakrig)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
library(atakrig)
library(debug)
mtrace(rbindDiscreteArea)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
library(atakrig)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
v.ok_combine <- deconvPointVgm(aod.combine, model=c("Sph","Exp","Gau"), ngroup=12, rd=0.75, maxSampleNum=100)
set.seed(100)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
v.ok_combine <- deconvPointVgm(aod.combine, model=c("Sph","Exp","Gau"), ngroup=12, rd=0.75, maxSampleNum=100)
# point-scale cross-variogram
aod.list <- list(aod3k=aod3k.d, aod10=aod10.d)
v.ck <- deconvPointVgmForCoKriging(aod.list, model="Exp", ngroup=12, rd=0.75, fixed.range=8e4, maxSampleNum=100)
v.ck$aod3k
v.ck$aod3k$pointVariogram
v.ok_combine$pointVariogram
library(atakrig)
library(raster)
## demo data ----
rpath <- system.file("extdata", package="atakrig")
aod3k <- raster(file.path(rpath, "MOD04_3K_A2017042.tif"))
aod10 <- raster(file.path(rpath, "MOD04_L2_A2017042.tif"))
aod3k.d <- discretizeRaster(aod3k, 1000)
aod10.d <- discretizeRaster(aod10, 1000)
aod3k.d$areaValues$value <- log(aod3k.d$areaValues$value)
aod10.d$areaValues$value <- log(aod10.d$areaValues$value)
set.seed(100)
# point-scale variogram from combined AOD-3k and AOD-10
aod.combine <- rbindDiscreteArea(aod3k.d, aod10.d)
sv.ok_combine <- deconvPointVgm(aod.combine, model="Exp", ngroup=12, rd=0.75, maxSampleNum=100)
# point-scale cross-variogram
aod.list <- list(aod3k=aod3k.d, aod10=aod10.d)
sv.ck <- deconvPointVgmForCoKriging(aod.list, model="Exp", ngroup=12, rd=0.75, fixed.range=8e4, maxSampleNum=100)
ataEnableCluster()
# prediction
grid.pred <- discretizeRaster(aod3k, 1000, type = "all")
# ok
pred.ataok <- ataKriging(aod10.d, grid.pred, sv.ck$aod10)
pred.ataok_combine <- ataKriging(aod.combine, grid.pred, sv.ok_combine)
# co-kriging (aod10 as primary variable)
pred.atack <- ataCoKriging(aod.list, unknownVar="aod10", unknown = grid.pred, ptVgms=sv.ck)
ataCoKriging
# co-kriging (aod10 as primary variable)
pred.atack <- ataCoKriging(aod.list, unknownVar="aod10", unknown = grid.pred, ptVgms=sv.ck)
library(atakrig)
ataEnableCluster()
# co-kriging (aod10 as primary variable)
pred.atack <- ataCoKriging(aod.list, unknownVar="aod10", unknown = grid.pred, ptVgms=sv.ck)
pred.atask2 <- ataCoKriging(aod.list, unknownVar="aod10", unknown = grid.pred, ptVgms=sv.ck, simple = TRUE, auxRatioAdj = T)
pred.atask2 <- ataCoKriging(aod.list, unknownVar="aod10", unknown=grid.pred, ptVgms=sv.ck, oneCondition=TRUE, auxRatioAdj=T)
# reverse log transform
pred.ataok$pred <- exp(pred.ataok$pred)
pred.ataok$var <- exp(pred.ataok$var)
pred.ataok_combine$pred <- exp(pred.ataok_combine$pred)
pred.ataok_combine$var <- exp(pred.ataok_combine$var)
pred.atack$pred <- exp(pred.atack$pred)
pred.atack$var <- exp(pred.atack$var)
pred.atask2$pred <- exp(pred.atask2$pred)
pred.atask2$var <- exp(pred.atask2$var)
# convert result to raster
pred.ataok.r <- rasterFromXYZ(pred.ataok[,-1])
pred.ataok_combine.r <- rasterFromXYZ(pred.ataok_combine[,-1])
pred.atack.r <- rasterFromXYZ(pred.atack[,-1])
pred.atask2.r <- rasterFromXYZ(pred.atask2[,-1])
# display
pred <- stack(aod3k, pred.ataok_combine.r$pred, pred.ataok.r$pred, pred.atack.r$pred, pred.atask2.r$pred)
names(pred) <- c("aod3k","ok_combine","ataok","atack","atask2")
spplot(pred) # col.regions = heat.colors(100)
# save to disk
writeRaster(pred.ataok.r, "./estimation/pred_ataok_byLogAOD10.tif", overwrite=TRUE)
getwd()
# save to disk
setwd("E:/AtoACokriging/Demo_BJ")
pred.ataok.r$pred
pred.ataok_combine.r$pred
pred.atack.r$pred
pred.atask2.r$pred
writeRaster(pred.ataok.r, "./estimation/pred_ataok_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.ataok_combine.r, "./estimation/pred_ataok_combine.tif", overwrite=TRUE)
writeRaster(pred.atack.r, "./estimation/pred_atack_byLogAOD10.tif", overwrite=TRUE)
writeRaster(pred.atask2.r, "./estimation/pred_atask2_byLogAOD10.tif", overwrite=TRUE)
save(list=ls(), file = "Demo_BJ_byLog3_simple.rdata")
ataStopCluster()
cor(pred.atack$pred, pred.ataok_combine$pred)
cor(pred.atask2$pred, pred.ataok_combine$pred)
cor(pred.ataok$pred, pred.ataok_combine$pred)
# Root Mean Squared Error
rmse <- function(error) {
sqrt(mean(error^2))
}
# Mean Absolute Error
mae <- function(error) {
mean(abs(error))
}
rmse(pred.ataok$pred - pred.ataok_combine$pred)
rmse(pred.atack$pred - pred.ataok_combine$pred)
rmse(pred.atask2$pred - pred.ataok_combine$pred)
mae(pred.ataok$pred - pred.ataok_combine$pred)  # 14.65281
mae(pred.atack$pred - pred.ataok_combine$pred)  # 15.67091
mae(pred.atask2$pred - pred.ataok_combine$pred) # 14.68022
aod3k.pt <- aod3k.d$areaValues
gok <- autofitVgm(aod3k.pt, ngroup=12, rd=0.75, fig = T)
gok <- autofitVgm(aod3k.pt, model = "Exp", ngroup=12, rd=0.75, fig = T)
gok <- autofitVgm(aod3k.pt, ngroup=12, rd=0.75, fig = T)
unknown <- grid.pred$areaValues
unknown.pt <- grid.pred$areaValues
rm(unknown)
aod3k.pt <- aod3k.d$areaValues
gok <- autofitVgm(aod3k.pt, ngroup=12, rd=0.75, fig = T)
unknown.pt <- grid.pred$areaValues
coordinates(aod3k.pt) = ~centx+centy
coordinates(unknown.pt) = ~centx+centy
pred.ok <- krige(value~1, aod3k.pt, newdata=unknown.pt, model=gok$model, nmax=10)
pred.ok$var1.pred <- exp(pred.ok$var1.pred)
pred.ok$var1.var <- exp(pred.ok$var1.var)
class(pred.ok)
spplot(pred.ok['var1.pred'])
gridded(pred.ok) <- TRUE
spplot(pred.ok['var1.pred'])
writeRaster(pred.ok['var1.pred'], "./estimation/pred_ok_gstat_byLog.tif", overwrite=TRUE)
writeRaster(raster(pred.ok['var1.pred']), "./estimation/pred_ok_gstat_byLog.tif", overwrite=TRUE)
pred.ok["var.pred"]
pred.ok["var1.pred"]
pred.ok["var1.pred"]@data
cor(pred.ok["var1.pred"]@data, pred.ataok_combine$pred)
rmse(pred.ok["var1.pred"]@data - pred.ataok_combine$pred)
rmse(pred.ok@data$var1.pred - pred.ataok_combine$pred)
cor(pred.ok@data$var1.pred, pred.ataok_combine$pred) # 0.8896274
rmse(pred.ok@data$var1.pred - pred.ataok_combine$pred)
mae(pred.ok@data$var1.pred - pred.ataok_combine$pred) #
aod3k
aod10
summary(aod3k[,])
summary(aod10[,])
3868/5041
60/484
21.843/3.7133
21.843/3.7133 * 30.593
30.593/5.882369
library(atakrig)
library(atakrig)
library(atakrig)
